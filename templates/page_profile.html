{% extends "base.html" %}

{% block title %}Page Profile - {{ page.title }}{% endblock %}

{% block content %}
<div class="card">
    <h2>Page Profile</h2>
    <div style="background: #2d2d2d; padding: 20px; border-radius: 8px; margin-top: 20px; border: 1px solid #404040;">
        <p style="color: #e0e0e0;"><strong style="color: #ffffff;">URL:</strong> <a href="{{ page.url }}"
                target="_blank" style="color: #3498db;">{{ page.url }}</a></p>
        <p style="color: #e0e0e0;"><strong style="color: #ffffff;">Title:</strong> {{ page.title }}</p>
        <p style="color: #e0e0e0;"><strong style="color: #ffffff;">Domain:</strong> <a
                href="{{ url_for('routes.domain_profile', domain_id=domain.id) }}" style="color: #3498db;">{{ domain.url
                }}</a></p>
        <p style="color: #e0e0e0;"><strong style="color: #ffffff;">Status:</strong>
            {% if page.get('is_active', True) %}
            <span class="badge badge-success">Active</span>
            {% else %}
            <span class="badge badge-danger">Removed</span>
            {% endif %}
        </p>
        <p style="color: #e0e0e0;"><strong style="color: #ffffff;">First Seen:</strong> {{ page.first_seen_at[:19] if
            page.first_seen_at else '-' }}</p>
        <p style="color: #e0e0e0;"><strong style="color: #ffffff;">Last Checked:</strong> {{ page.last_checked_at[:19]
            if page.last_checked_at else '-' }}</p>
        {% if not page.get('is_active', True) %}
        <p style="color: #e0e0e0;"><strong style="color: #ffffff;">Removed At:</strong> {{ page.get('removed_at',
            'Unknown')[:19] }}</p>
        {% endif %}
        <p style="color: #e0e0e0;"><strong style="color: #ffffff;">Content Hash:</strong> <code
                style="font-size: 0.8em; background: #1a1a1a; color: #e74c3c; padding: 4px 8px; border: 1px solid #404040;">{{ page.content_hash }}</code>
        </p>
    </div>
</div>

<div class="card">
    <h2>Change History ({{ changes|length }})</h2>
    {% if changes %}
    <table>
        <thead>
            <tr>
                <th>Type</th>
                <th>Detected At</th>
                <th>Similarity</th>
                <th>Diff</th>
                <th>Notified</th>
            </tr>
        </thead>
        <tbody>
            {% for change in changes %}
            <tr>
                <td>
                    {% if change.change_type == 'new' %}
                    <span class="badge badge-success">NEW</span>
                    {% elif change.change_type == 'modified' %}
                    <span class="badge badge-warning">MODIFIED</span>
                    {% elif change.change_type == 'removed' %}
                    <span class="badge badge-danger">REMOVED</span>
                    {% endif %}
                </td>
                <td>{{ change.detected_at[:19] }}</td>
                <td>
                    {% if change.similarity_score %}
                    {{ "%.1f"|format(change.similarity_score * 100) }}%
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>
                    {% if change.diff_path %}
                    <span class="badge badge-info">Available</span>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>
                    {% if change.notified %}
                    <span class="badge badge-success">✓</span>
                    {% else %}
                    <span class="badge badge-danger">✗</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; color: #999; padding: 40px;">
        No changes detected for this page yet.
    </p>
    {% endif %}
</div>

<div style="text-align: center; margin-top: 30px;">
    <a href="{{ url_for('routes.domain_profile', domain_id=domain.id) }}" class="btn">← Back to Domain</a>
    <a href="{{ url_for('routes.index') }}" class="btn">Home</a>
</div>
{% endblock %}